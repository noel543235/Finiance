<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <title>My test page</title>
        {% load static %} 
        {% load bootstrap5 %} 
        {% bootstrap_css %} 
        {%bootstrap_javascript %}
        <link rel="stylesheet" href="{% static 'savings/style.css' %}" />
    </head>
    <nav>
        <div>
            <ul>
                <li><p>Finiance</p></li>
                <li class="link"><a href="http://127.0.0.1:8000/">Home</a></li>
                <li class="link">
                    <a href="http://127.0.0.1:8000/savings">Savings</a>
                </li>
                <li class="link">
                    <a href="http://127.0.0.1:8000/expenses">Expenses</a>
                </li>
                <li class="link">
                    <a href="http://127.0.0.1:8000/subscriptions"
                        >Subscriptions</a
                    >
                </li>
                <li class="link">
                    <a href="http://127.0.0.1:8000/accountinfo">Account Info</a>
                </li>
                <li class="link">
                    <a href="http://127.0.0.1:8000/login/login">Log In</a>
                </li>
            </ul>
        </div>
    </nav>
    <body>
      <div class="section1 row">
          <div class="col">
              <div class="circle1 mb-5"></div>
              <div style="margin-left: 105px;">
                <form method="GET" action="">
                  <label class="text-white fw-bold fs-4" for="frequency">Select Frequency:</label>
                  <select id="frequency" class="form-select w-50">
                      <option value="Monthly">Monthly</option>
                      <option value="Weekly">Weekly</option>
                      <option value="Yearly">Yearly</option>
                  </select>
              </form>
            </div>
          </div>
          <div class="col hello text-white ">
            <h3 class="text-white fw-bold" id="savingsHeading">Expenses for month</h3>

              <ul class="list-unstyled fs-4">
                  {% for expense in expenses %}
                  <li >{{ expense.label }}: ${{ expense.amount }}</li>
                  {% endfor %}
              </ul>
          </div>
      </div>
      <div class="row p-3 mt-3 ms-5 fs-4">
        <div class="col ms-5">
          <p class="fw-bold">Emergencey Fund: Please Add An Emergency Fund!</p>
          <p class="d-inline-flex gap-1">
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
              Press Here to edit your Emergency Fund
            </button>
          </p>
          <div class="collapse" id="collapseExample">
            <div class="card card-body w-50">
              Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.
            </div>
          </div>
          <p class="mt-3 fw-bold">Emergencey Fund Goal: Please Add An Emergency Fund Goal!</p>
          <p class="d-inline-flex gap-1">
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample2" aria-expanded="false" aria-controls="collapseExample2">
              Press Here to edit your Emergency Fund Goal
            </button>
          </p>
          <div class="collapse" id="collapseExample2">
            <div class="card card-body w-50">
              Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.
            </div>
          </div>
          <p class="mt-3 fw-bold">Savings</p>
          <p class="d-inline-flex gap-1">
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample3" aria-expanded="false" aria-controls="collapseExample3">
              Press Here to edit your Savings
            </button>
          </p>
          <div class="collapse" id="collapseExample3">
            <div class="card card-body w-50">
              Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.
            </div>
          </div>
          <p class="mt-3 fw-bold">Saving Goals</p>
          <p class="d-inline-flex gap-1">
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample4" aria-expanded="false" aria-controls="collapseExample4">
              Press Here to edit your Saving Goals
            </button>
          </p>
          <div class="collapse" id="collapseExample4">
            <div class="card card-body w-50">
              Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.
            </div>
          </div>
        </div>
        <div class="col me-5">
          <p class="fw-bold">Saving Goals</p>
          <p>New Car</p>
          <div class="progress mb-1 bg-white border border-1" role="progressbar" aria-label="Basic example" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar ms-1" style="width: 0%"></div>
          </div>
          <p>Travel fund</p>
          <div class="progress mb-1 bg-white border border-1" role="progressbar" aria-label="Basic example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar ms-1" style="width: 25%"></div>
          </div>
          <p>Home Down Payment</p>
          <div class="progress mb-1 bg-white border border-1" role="progressbar" aria-label="Basic example" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar ms-1" style="width: 50%"></div>
          </div>
          <p>laundry machines upgrade</p>
          <div class="progress mb-1 bg-white border border-1" role="progressbar" aria-label="Basic example" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar ms-1" style="width: 75%"></div>
          </div>
          <p>Emergencey fund</p>
          <div class="progress mb-1 bg-white border border-1" role="progressbar" aria-label="Basic example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar ms-1" style="width: 100%"></div>
          </div>
          <p class="fw-bold mt-3">Savings Break Down</p>
          <table>
            <tr>
              <th>Category</th>
              <th>Ammount Saved</th>
              <th>Percentage</th>
            </tr>
            <tr>
              <td>Home Down Payment</td>
              <td>$3000</td>
              <td>35%</td>
            </tr>
            <tr>
              <td>Car Fund</td>
              <td>$2000</td>
              <td>24%</td>
            </tr>
            <tr>
              <td>Emergency Fund</td>
              <td>$1500</td>
              <td>18%</td>
            </tr>
            <tr>
              <td>Vacation Fund</td>
              <td>$1000</td>
              <td>12%</td>
            </tr>
            <tr>
              <td>Education Savings</td>
              <td>$500</td>
              <td>6%</td>
            </tr>
            <tr>
              <td>Tech Upgrade</td>
              <td>$500</td>
              <td>6%</td>
            </tr>
          </table>
          <p class="fw-bold mt-3">Projected Savings estimation</p>
          <table>
            <tr class="me-1">
              <th>Month</th>
              <th>Starting Balance</th>
              <th>Deposit</th>
              <th>Interest Earned</th>
              <th>New Balance</th>
            </tr>
            <tr>
              <td>1</td>
              <td>$2000.00</td>
              <td>$300.00</td>
              <td>$8.63</td>
              <td>$2308.33</td>
            </tr>
            <tr>
              <td>2</td>
              <td>$2308.33</td>
              <td>$300.00</td>
              <td>$9.61</td>
              <td>$2617.94</td>
            </tr>
            <tr>
              <td>3</td>
              <td>$2617.95</td>
              <td>$300.00</td>
              <td>$10.91</td>
              <td>$2928.85</td>
            </tr>
            <tr>
              <td>12</td>
              <td>$5405.88</td>
              <td>$300.00</td>
              <td>$22.62</td>
              <td>$5,748.50</td>
            </tr>
          </table>
        </div>
      </div>

      <div class="section1 row">
          <div class="col">
              <form class="text-white">
                  <label class="mb-5">Number of Periods</label>
                  <input type="number" value="10" />
                  <br />
                  <label class="mb-5">Starting Amount</label>
                  <input type="number" value="1000" />
                  <br />
                  <label class="mb-5">Interest Rate</label>
                  <input type="number" value="6" />
                  <br />
                  <label class="mb-5">Periodic Deposit</label>
                  <input type="number" value="100" />
                  <br />
                  <p>Time when you want to make it</p>
                  <label class="mb-5">Beginning</label>
                  <input type="radio" />
                  <br />
                  <label class="mb-5">End</label>
                  <input type="radio" />
                  <br />
                  <button>Calculate</button>
              </form>
          </div>
          <div class="col">
              <div class="line bg-secondary p-3">
                  <h4>Results: Please Put in a Calculation</h4>
              </div>
          </div>
      </div>
    </body>
</html>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        updateCircle(); // Call update function on page load
    });

    const expenses_url = "{% url 'get_expenses' %}";

    document.getElementById("frequency").addEventListener("change", function () {
            const frequency = this.value;
            document.getElementById("savingsHeading").textContent = `Savings for ${frequency.slice(0, -2)}`;

            // Fetch new proportions when frequency changes
            fetch(`${expenses_url}?frequency=${frequency}`).then((response) => response.json()).then(data => {

              // Handle the response data here
              document.getElementById("savingsHeading").textContent = `Expenses for ${frequency.slice(0, -2)}`;
              updateCircle(data.proportions);

              // Update the expenses list
              const expensesList = document.querySelector(".hello ul");
              expensesList.innerHTML = ""; // Clear existing list

              data.expenses.forEach(expense => {
                  const listItem = document.createElement("li");
                  listItem.textContent = `${expense.label}: $${expense.amount}`;
                  expensesList.appendChild(listItem);
              });

            }).catch((error) => console.error("Error fetching expenses:", error));
        });

    function updateCircle(proportions = null) {

        // Get proportions from template if not provided by AJAX
        var proportions = proportions || JSON.parse("{{ proportions|safe }}");

        let gradient = "conic-gradient(";
        let startDeg = 0;

        proportions.forEach((degree, index) => {
            let color = getColor(index);
            gradient += `${color} ${startDeg}deg ${startDeg + degree}deg, `;
            startDeg += degree;
        });

        gradient = gradient.slice(0, -2) + ")";

        document.querySelector(".circle1").style.background = gradient;
    }

    function getColor(index) {
        const colors = [
            "#DB93B0",
            "#9046CF",
            "#2D2A32",
            "#AB3428",
            "#6FD872",
            "#002A22",
        ];
        return colors[index % colors.length];
    }
</script>
